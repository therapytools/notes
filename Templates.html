<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template-Based Notes</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            background-color: #f4f7f9;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        h2 {
             border-bottom: 2px solid #e0e0e0;
             padding-bottom: 10px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-top: 15px;
            margin-bottom: 5px;
        }
        select, textarea, input[type="text"] {
            width: 100%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 16px;
            box-sizing: border-box;
            margin: 10px 0;
            transition: border-color 0.2s;
        }
        select:focus, textarea:focus, input[type="text"]:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.25);
        }
        textarea {
            resize: vertical;
            min-height: 100px;
            overflow-y: hidden;
        }
        optgroup {
            font-weight: bold;
            font-style: normal;
            background-color: #f0f0f0;
            color: #000;
        }
        option {
            padding: 5px 15px;
        }
        .note-container p, .note-container div {
            margin: 0;
            padding: 0;
        }
        .dynamic-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        .dynamic-row select, .dynamic-row input {
            flex-grow: 1;
            margin: 0;
        }
        .add-btn, .remove-btn {
            flex-shrink: 0;
            width: 38px;
            height: 38px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 50%;
            border: 1px solid #ccc;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .add-btn {
            background-color: #28a745;
            color: white;
            border-color: #218838;
        }
        .add-btn:hover {
            background-color: #218838;
        }
        .remove-btn {
            background-color: #dc3545;
            color: white;
            border-color: #c82333;
        }
        .remove-btn:hover {
            background-color: #c82333;
        }

        .checkbox-container {
            display: flex;
            align-items: flex-start;
            margin: 15px 0;
            background-color: #e9f5ff;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #bde0ff;
        }
        .checkbox-container input[type="checkbox"] {
            margin-right: 12px;
            margin-top: 5px;
            flex-shrink: 0;
            width: 18px;
            height: 18px;
        }
        .checkbox-container input[type="checkbox"]:disabled + label {
            color: #999;
        }
        .checkbox-container label, .scenario-label-text {
            margin: 0;
            font-weight: normal;
            line-height: 1.5;
        }
        .scenarios-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }
        .scenario-group {
            margin-bottom: 15px;
            padding-left: 20px; /* This indents the scenario groups */
        }
        .scenario-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .info-box {
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            padding: 15px;
            margin-top: 5px;
        }
        .copy-area-container {
            margin-top: 30px;
        }
        #final-note-copy {
            background-color: #fdfdff;
            min-height: 200px;
            color: #333;
            border: 1px solid #ccc;
        }
        .copy-button {
            display: block;
            width: 100%;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            background-color: #28a745;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.2s;
        }
        .copy-button:hover {
            background-color: #218838;
        }
        .copy-button:active {
            background-color: #1e7e34;
        }
        .hidden {
            display: none;
        }
        .inline-form-element {
            display: inline-block;
            width: auto;
            min-width: 150px;
            margin: 0 5px;
            vertical-align: baseline;
        }
        .telehealth-text {
            line-height: 2.5;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Template-Based Notes</h1>

    <label for="note-type-select">Select Note Type:</label>
    <select id="note-type-select">
        <option value="eval-cd">Evaluation - Chemical Dependency</option>
        <option value="eval-so">Evaluation - Significant Other</option>
        <option value="entry-cd">Entry Session - Chemical Dependency</option>
        <option value="entry-so">Entry Session - Significant Other</option>
        <option value="narcan-kit">Narcan Education & Kit</option>
        <option value="mat-education">MAT Education</option>
        <option value="telehealth">Telehealth</option>
        <option value="closing-note-admitted">Closing Note – Admitted</option>
        <option value="closing-note-non-admitted">Closing Note – Non-Admitted</option>
    </select>

    <!-- Container for Evaluation - Chemical Dependency Note -->
    <div id="eval-cd-container" class="note-container hidden">
        <h2 style="margin-top: 20px;">Note Details</h2>
        <p>The client presented for services and meets diagnostic criteria for a substance use disorder, specifically</p>
        <div id="diagnosis-container"></div>
        <p>, as evidenced by:</p>
        <textarea id="details-criteria" placeholder="Enter details here..."></textarea>
        <p>The clinician reviewed: Program expectations, rules, and attendance policies; Delphi Rise’s policy as a tobacco, nicotine, alcohol, and drug-free environment; and Client rights and responsibilities, including HIPAA and 42 CFR Part 2 confidentiality protections.</p>
        <br>
        <p>The clinician confirmed client understanding and emphasized the collaborative nature of recovery, highlighting the agency’s role in supporting the client’s treatment goals. The client demonstrated an understanding that participation in services is voluntary and may be discontinued at any time.</p>
        <div class="checkbox-container">
            <input type="checkbox" id="mandate-checkbox">
            <label for="mandate-checkbox">Include the following mandate information: The clinician clarified the implications of external mandates, noting that mandated status does not override the client’s right to voluntary engagement in treatment or toxicology screenings. Corresponding handouts were provided.</label>
        </div>
        <p>The clinician reviewed the client’s screening results and supported the client in understanding their scores. A comprehensive review of the client’s presenting concerns, referral reason, psychosocial needs, and current and historical functioning was conducted to assess eligibility for Outpatient services. The client's initial treatment goal is to complete the evaluation process; additional goals will be developed collaboratively in future sessions.</p>
        <div class="scenarios-section">
            <h2>Scenarios</h2>
            <p style="margin-bottom: 1rem;"><strong>PHQ-9 Score ≥9 or any suicide risk on C-SSRS:</strong></p>
            <div class="scenario-group">
                <p class="scenario-label">If the client has a mental health provider:</p>
                <div class="scenario-content checkbox-container">
                    <input type="checkbox" id="cd-has-mh-provider-text">
                    <label for="cd-has-mh-provider-text" class="scenario-label-text">The clinician discussed the client’s engagement with their current provider, encouraged prompt follow-up due to screening results, and reviewed additional mental health resources if the client wishes to explore other providers. A signed release was obtained to coordinate care.</label>
                </div>
                 <div class="scenario-content checkbox-container">
                    <input type="checkbox" id="cd-safety-plan-has-provider">
                    <label for="cd-safety-plan-has-provider" class="scenario-label-text">A safety plan was developed collaboratively.</label>
                </div>
            </div>
            <div class="scenario-group">
                <p class="scenario-label">If the client does not have a mental health provider:</p>
                <div class="scenario-content checkbox-container">
                    <input type="checkbox" id="cd-no-mh-provider-text">
                    <label for="cd-no-mh-provider-text" class="scenario-label-text">The clinician provided a list of mental health referral options, reviewed the benefits of a comprehensive mental health evaluation, and offered support in making and completing the referral.</label>
                </div>
                 <div class="scenario-content checkbox-container">
                    <input type="checkbox" id="cd-safety-plan-no-provider">
                    <label for="cd-safety-plan-no-provider" class="scenario-label-text">A safety plan was developed to address suicide risk.</label>
                </div>
            </div>
            <h2>Other Scenarios</h2>
            <div class="scenario-group">
                <p class="scenario-label">Overdose Risk Identified:</p>
                 <div class="scenario-content checkbox-container">
                    <input type="checkbox" id="cd-overdose-risk">
                    <label for="cd-overdose-risk" class="scenario-label-text">The clinician reviewed the client’s overdose risk factors and collaborated with the client to create a personalized safety plan.</label>
                </div>
            </div>
             <div class="scenario-group">
                <p class="scenario-label">High-Risk Gambling Screen:</p>
                 <div class="scenario-content checkbox-container">
                    <input type="checkbox" id="cd-gambling-risk">
                    <label for="cd-gambling-risk" class="scenario-label-text">The clinician reviewed the client’s gambling screen results and initiated a referral to an in-house counselor trained in gambling treatment for further support.</label>
                </div>
            </div>
        </div>
    </div>

    <!-- Container for Evaluation - Significant Other Note -->
    <div id="eval-so-container" class="note-container hidden">
        <h2 style="margin-top: 20px;">Note Details</h2>
        <p>The client presented for services due to experiencing stress related to supporting someone in their life who struggles with substance use. The client meets diagnostic criteria, specifically</p>
        <select id="so-diagnosis-select">
            <option value="" selected disabled>Select a diagnosis...</option>
            <option value="Z63.72 Alcoholism and drug addiction in family">Z63.72 Alcoholism and drug addiction in family</option>
            <option value="Z63.8 Other specified problems related to primary support group">Z63.8 Other specified problems related to primary support group</option>
        </select>
        <p>, as evidenced by:</p>
        <textarea id="so-details-criteria" placeholder="Enter details here..."></textarea>
        <p>The clinician reviewed: Program expectations, rules, and attendance policies; Delphi Rise’s policy as a tobacco, nicotine, alcohol, and drug-free environment; and Client rights and responsibilities, including HIPAA and 42 CFR Part 2 confidentiality protections.</p>
        <br>
        <p>The clinician confirmed client understanding and emphasized the collaborative nature of treatment, highlighting the agency’s role in supporting the client’s treatment goals. The client demonstrated an understanding that participation in services is voluntary and may be discontinued at any time.</p>
        <br>
        <p>The clinician reviewed the client’s screening results and supported the client in understanding their scores. A comprehensive review of the client’s presenting concerns, referral reason, psychosocial needs, and current and historical functioning was conducted to assess eligibility for Outpatient services. The client's initial treatment goal is to complete the evaluation process; additional goals will be developed collaboratively in future sessions.</p>
        <div class="scenarios-section">
            <h2>Scenarios</h2>
            <p style="margin-bottom: 1rem;"><strong>PHQ-9 Score ≥9 or any suicide risk on C-SSRS:</strong></p>
            <div class="scenario-group">
                <p class="scenario-label">If the client has a mental health provider:</p>
                <div class="scenario-content checkbox-container">
                    <input type="checkbox" id="so-has-mh-provider-text">
                    <label for="so-has-mh-provider-text" class="scenario-label-text">The clinician discussed the client’s engagement with their current provider, encouraged prompt follow-up due to screening results, and reviewed additional mental health resources if the client wishes to explore other providers. A signed release was obtained to coordinate care.</label>
                </div>
                 <div class="scenario-content checkbox-container">
                    <input type="checkbox" id="so-safety-plan-has-provider">
                    <label for="so-safety-plan-has-provider" class="scenario-label-text">A safety plan was developed collaboratively.</label>
                </div>
            </div>
            <div class="scenario-group">
                <p class="scenario-label">If the client does not have a mental health provider:</p>
                <div class="scenario-content checkbox-container">
                    <input type="checkbox" id="so-no-mh-provider-text">
                    <label for="so-no-mh-provider-text" class="scenario-label-text">The clinician provided a list of mental health referral options, reviewed the benefits of a comprehensive mental health evaluation, and offered support in making and completing the referral.</label>
                </div>
                 <div class="scenario-content checkbox-container">
                    <input type="checkbox" id="so-safety-plan-no-provider">
                    <label for="so-safety-plan-no-provider" class="scenario-label-text">A safety plan was developed to address suicide risk.</label>
                </div>
            </div>
            <h2>Other Scenarios</h2>
            <div class="scenario-group">
                <p class="scenario-label">Overdose Risk Identified:</p>
                 <div class="scenario-content checkbox-container">
                    <input type="checkbox" id="so-overdose-risk">
                    <label for="so-overdose-risk" class="scenario-label-text">The clinician reviewed the client’s overdose risk factors and collaborated with the client to create a personalized safety plan.</label>
                </div>
            </div>
             <div class="scenario-group">
                <p class="scenario-label">High-Risk Gambling Screen:</p>
                 <div class="scenario-content checkbox-container">
                    <input type="checkbox" id="so-gambling-risk">
                    <label for="so-gambling-risk" class="scenario-label-text">The clinician reviewed the client’s gambling screen results and initiated a referral to an in-house counselor trained in gambling treatment for further support.</label>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Container for Entry Session - Chemical Dependency Note -->
    <div id="entry-cd-container" class="note-container hidden">
        <h2 style="margin-top: 20px;">Note Details</h2>
        <p>The client has identified personal goals to support their recovery, including:</p>
        <div id="client-goals-container"></div>
        <p>Based on the client’s psychosocial needs, current presentation, and clinical history, the client is expected to benefit from the following treatment plan goals:</p>
        <div id="treatment-goals-container"></div>
        <p>The clinician reviewed all services available through the Outpatient clinic, with a focus on peer support, medication management, and therapeutic group offerings. Corresponding handouts were provided to support the client’s engagement and alignment with their identified recovery goals.</p>
    </div>
    
    <!-- Container for Entry Session - Significant Other Note -->
    <div id="entry-so-container" class="note-container hidden">
        <h2 style="margin-top: 20px;">Note Details</h2>
        <p>The client has identified personal goals to support their recovery, including:</p>
        <div id="so-client-goals-container"></div>
        <p>Based on the client’s psychosocial needs, current presentation, and clinical history, the client is expected to benefit from the following treatment plan goals:</p>
        <div id="so-treatment-goals-container"></div>
        <p>The clinician reviewed all services available through the Outpatient clinic, with a focus on peer support, medication management, and therapeutic group offerings. Corresponding handouts were provided to support the client’s engagement and alignment with their identified recovery goals.</p>
    </div>

    <!-- Container for Narcan Education & Kit -->
    <div id="narcan-container" class="note-container hidden">
        <h2 style="margin-top: 20px;">Note Details</h2>
        <div class="checkbox-container">
            <input type="checkbox" id="narcan-provided-checkbox">
            <label for="narcan-provided-checkbox">Education provided: I provided client with an overview of Narcan, showed a brief video demonstrating how to use, and provided a Narcan kit.</label>
        </div>
        <div class="checkbox-container">
            <input type="checkbox" id="narcan-declined-checkbox">
            <label for="narcan-declined-checkbox">Narcan training declined.</label>
        </div>

        <h2 style="margin-top: 20px;">Instructions</h2>
        <p><strong>What to say to the client:</strong></p>
        <p>“Narcan is a medicine that can save someone’s life during an opioid overdose. It works by quickly blocking the effects of opioids and helping the person breathe again. Narcan is easy to use and can be given by anyone, even without medical training. Having Narcan nearby can give people a second chance and time to get more help. It’s safe, doesn’t hurt someone if they didn’t take opioids, and can help prevent deaths from overdose.”</p>
        <br>
        <p><strong>Links:</strong></p>
        <p>Video: <a href="https://youtu.be/WnjgrRNMfKM?si=WvTS0Re5ZgYT79iP" rel="external">NARCAN Nasal Spray - How to use</a></p>
        <p>Handout: <a href="https://www.health.ny.gov/publications/12028.pdf" rel="external">How to use Narcan Nasal Spray for an opioid overdose</a></p>
    </div>

    <!-- Container for MAT Education -->
    <div id="mat-container" class="note-container hidden">
        <h2 style="margin-top: 20px;">MAT Education</h2>
        <label for="mat-education-type">Type of Education Provided:</label>
        <select id="mat-education-type">
            <option value="" selected disabled>Select an option...</option>
            <option value="not-taking">For Clients Not Already Taking MAT</option>
            <option value="already-taking">For Clients Already Taking MAT</option>
        </select>
        
        <div id="mat-not-taking-info" class="info-box hidden">
            <p><em>Medication Assisted Treatment (MAT) has been introduced, and education has been offered based on client's history and current presentation. Writer provided client with an overview of MAT’s benefits & risks, and offered to connect client to medication management in our clinic, including smoking and nicotine cessation services.</em></p>
        </div>
        <div id="mat-already-taking-info" class="info-box hidden">
            <p><em>Client is currently taking medication to manage their Substance Use Disorder.</em></p>
        </div>

        <div id="mat-form-fields">
            <label for="mat-response-dropdown">Client’s Response/Readiness:</label>
            <select id="mat-response-dropdown">
                <option value="" selected disabled>Select a response...</option>
                <option>Client expressed interest in MAT and a referral was offered to a Delphi Rise provider</option>
                <option>Client declined at this time</option>
                <option>Client is happy with their current provider</option>
            </select>
            <label for="mat-substances-textbox">MAT is recommended for the following substance(s):</label>
            <input type="text" id="mat-substances-textbox" placeholder="e.g., opioids, alcohol...">
            <label for="mat-explored-options-dropdown">Explored Specific MAT Options?</label>
            <select id="mat-explored-options-dropdown">
                <option value="" selected disabled>Select an option...</option>
                <option value="did">Writer and Client explored specific options that are currently available</option>
                <option value="did-not">Writer deferred a conversation about specific options to the medical staff</option>
            </select>
            <label for="mat-nicotine-use-dropdown">Client's Nicotine Use:</label>
            <select id="mat-nicotine-use-dropdown">
                <option value="" selected disabled>Select an option...</option>
                <option value="does">Client does current use nicotine</option>
                <option value="does-not">Client does not current use nicotine</option>
            </select>
            <div id="mat-nicotine-resources-section">
                <label>The following nicotine cessation resources were provided:</label>
                <div class="checkbox-container">
                    <input type="checkbox" id="mat-nicotine-replacement-checkbox">
                    <label for="mat-nicotine-replacement-checkbox">nicotine replacement options</label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="mat-nicotine-counseling-checkbox">
                    <label for="mat-nicotine-counseling-checkbox">tobacco cessation counseling</label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="mat-nicotine-referral-checkbox">
                    <label for="mat-nicotine-referral-checkbox">referral to a tobacco cessation program</label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="mat-nicotine-other-checkbox">
                    <label for="mat-nicotine-other-checkbox">other</label>
                </div>
                <input type="text" id="mat-nicotine-other-textbox" class="hidden" placeholder="Specify other resource...">
            </div>
        </div>

        <div class="info-box" style="margin-top: 20px;">
            <label>Talking Points for Client Discussion:</label>
            <p>Studies show that using both medicine and therapy can help people who have problems with drugs or alcohol. For some people, medicine can make it easier to stay in recovery. These medicines are safe and approved by the Food and Drug Administration (FDA). Doctors pick the right medicine for each person to help them get better and avoid dangerous overdoses. Medicine can also help people live longer, stay in treatment, stop using illegal drugs, stay out of trouble, keep their jobs, have healthier babies if they’re pregnant, and lower the chance of getting diseases like HIV or hepatitis C. There are a few things to keep in mind. A doctor needs to check on you often, the medicine might cause side effects, and some people might misuse it.</p>
            <br>
            <a href="https://www.dhcs.ca.gov/individuals/Documents/MAT_Toolkit_for_Counselors.pdf" target="_blank">Medication Assisted Treatment Toolkit for Counselors</a>
        </div>
    </div>
    
    <!-- Container for Telehealth Note -->
    <div id="telehealth-container" class="note-container hidden">
        <h2 style="margin-top: 20px;">Telehealth Note Details</h2>
        <div class="telehealth-text">
            This session was conducted via 
            <select id="telehealth-visit-type" class="inline-form-element">
                <option value="" selected disabled>Select...</option>
                <option value="video">video</option>
                <option value="telephone">telephone</option>
            </select>
            , and client is clinically appropriate to receive services via telepractice. The use of telepractice was due to 
            <select id="telehealth-reason" class="inline-form-element">
                <option value="" selected disabled>Select...</option>
                <option value="client preference">client preference</option>
                <option value="location of the practitioner">location of the practitioner</option>
                <option value="location of the client">location of the client</option>
                <option value="lack of access to a video-enabled device">lack of access to a video-enabled device</option>
                <option value="temporary connectivity disruption">temporary connectivity disruption</option>
                <option value="other">other</option>
            </select>
            <input type="text" id="telehealth-reason-other" class="inline-form-element" style="display:none;" placeholder="specify...">
            . There 
            <select id="telehealth-disruption" class="inline-form-element">
                <option value="" selected disabled>Select...</option>
                <option value="were no service disruptions during the session">were no service disruptions during the session</option>
                <option value="was a service disruption">was a service disruption</option>
            </select>
            <span id="telehealth-disruption-followup" class="hidden">. Writer will follow up by <input type="text" id="telehealth-disruption-plan" class="inline-form-element" placeholder="plan for follow-up..."></span>
            . The client was located at 
            <input type="text" id="telehealth-client-location" class="inline-form-element" placeholder="client location">
            , and the practitioner was located at 
            <input type="text" id="telehealth-practitioner-location" class="inline-form-element" placeholder="practitioner location">
            at the time of the session. 
            <select id="telehealth-presence-dropdown" class="inline-form-element">
                <option value="" selected disabled>Select presence...</option>
                <option value="only">Provider and client were the only individuals present in the session.</option>
                <option value="others">In addition to the provider and client, the following individual(s) were present with the client:</option>
            </select>
            <input type="text" id="telehealth-others-present" class="inline-form-element" style="display:none;" placeholder="specify...">
            . The client was asked about their satisfaction with receiving services via telepractice and 
            <select id="telehealth-satisfaction" class="inline-form-element">
                <option value="" selected disabled>Select...</option>
                <option value="reported satisfaction">reported satisfaction</option>
                <option value="expressed the following concerns:">expressed the following concerns:</option>
            </select>
            <input type="text" id="telehealth-satisfaction-concerns" class="inline-form-element" style="display:none;" placeholder="specify...">
            .
        </div>
    </div>

    <!-- Container for Closing Note - Admitted -->
    <div id="closing-note-admitted-container" class="note-container hidden">
        <h2 style="margin-top: 20px;">Closing Note Details</h2>
        <p>Client was discharged due to <input type="text" id="closing-reason" placeholder="reason for discharge...">. Treatment recommendations include <input type="text" id="closing-recommendations" placeholder="recommended treatment plan...">. The client 
        <select id="closing-meds-dropdown">
            <option value="" selected disabled>Select...</option>
            <option value="is">is</option>
            <option value="is not">is not</option>
        </select>
        currently prescribed medications most recently prescribed at Delphi.</p>
        
        <div id="closing-meds-actions-container" class="hidden">
            <p>The following actions were taken to support the client’s medication management: <input type="text" id="closing-meds-actions" placeholder="describe actions taken..."></p>
        </div>

        <p>Referrals initiated to support the client post-discharge include: <input type="text" id="closing-referrals" placeholder="list referrals..."></p>
        <p>The 
        <select id="closing-offered-to-dropdown">
            <option value="client">client</option>
            <option value="client and guardian">client and guardian</option>
        </select>
        was offered a copy of their discharge plan, a recovery resource handout outlining community resources for urgent support, harm reduction resources, referrals to MAT providers and recovery peer services, and an overdose prevention/Narcan kit.</p>
        <label for="closing-client-response">Client's Response to Resources Offered at Discharge:</label>
        <input type="text" id="closing-client-response" placeholder="Enter client's response...">
    </div>

    <!-- Container for Closing Note - Non-Admitted -->
    <div id="closing-note-non-admitted-container" class="note-container hidden">
        <h2 style="margin-top: 20px;">Closing Note Details</h2>
        <label for="non-admitted-client-type">Client Type:</label>
        <select id="non-admitted-client-type">
            <option value="" selected disabled>Select...</option>
            <option value="no-engage">Client did not engage in evaluation</option>
            <option value="higher-loc">Client is recommended to a higher level of care</option>
            <option value="no-criteria">Client does not meet criteria</option>
        </select>

        <div id="non-admitted-no-engage-section" class="hidden">
            <p>Client will not be admitted for treatment at this time due to not engaging in treatment beyond their evaluation(s). Engagement efforts included <input type="text" id="non-admitted-efforts" placeholder="list efforts...">. The decision not to admit was provided via mail to client <input type="text" id="non-admitted-provided-to-1" placeholder="and also provided to...">. Included in this letter is a recovery resource handout outlining community resources for urgent support, harm reduction resources, MAT providers, and recovery peer services.</p>
        </div>
        <div id="non-admitted-higher-loc-section" class="hidden">
            <p>The client will not be admitted for treatment at this time, as they meet criteria for a higher level of care <input type="text" id="non-admitted-locadtr" placeholder="LOCADTR outcome...">. Following a thorough review and discussion by the multidisciplinary team, it was determined that the client’s needs would be more safely and appropriately addressed in a setting equipped to provide a higher intensity of services. Efforts to explore treatment options and identify appropriate referrals were made, including: <input type="text" id="non-admitted-efforts-2" placeholder="list efforts made...">. The decision not to admit was communicated to the client via mail <input type="text" id="non-admitted-provided-to-2" placeholder="and also provided to...">. Included in the letter was a recovery resource handout outlining local options for urgent support, harm reduction services, MAT providers, and peer recovery resources.</p>
        </div>
        <div id="non-admitted-no-criteria-section" class="hidden">
            <p>Client will not be admitted for treatment at this time due to not meeting admission criteria. Urine screen was negative, no concerns were reported by collateral contacts, and LOCADTR does not indicate a recommended level of care. An outcome letter was provided to the client <input type="text" id="non-admitted-provided-to-3" placeholder="and..."></p>
        </div>
    </div>


    <!-- Read-only Note Output for Copying -->
    <div class="copy-area-container">
        <h2>Copy Area</h2>
        <textarea id="final-note-copy"></textarea>
        <button id="copy-button" class="copy-button">Copy Note to Clipboard</button>
    </div>
</div>

<script>
    // Get all interactive elements
    const noteTypeSelect = document.getElementById('note-type-select');
    const finalNoteCopy = document.getElementById('final-note-copy');
    const copyButton = document.getElementById('copy-button');

    // Eval-CD elements
    const diagnosisContainer = document.getElementById('diagnosis-container');
    const detailsTextarea = document.getElementById('details-criteria');
    const mandateCheckbox = document.getElementById('mandate-checkbox');
    const cdHasMhProviderTextCheckbox = document.getElementById('cd-has-mh-provider-text');
    const cdSafetyPlanHasProviderCheckbox = document.getElementById('cd-safety-plan-has-provider');
    const cdNoMhProviderTextCheckbox = document.getElementById('cd-no-mh-provider-text');
    const cdSafetyPlanNoProviderCheckbox = document.getElementById('cd-safety-plan-no-provider');
    const cdOverdoseRiskCheckbox = document.getElementById('cd-overdose-risk');
    const cdGamblingRiskCheckbox = document.getElementById('cd-gambling-risk');

    // Eval-SO elements
    const soDiagnosisSelect = document.getElementById('so-diagnosis-select');
    const soDetailsTextarea = document.getElementById('so-details-criteria');
    const soHasMhProviderTextCheckbox = document.getElementById('so-has-mh-provider-text');
    const soSafetyPlanHasProviderCheckbox = document.getElementById('so-safety-plan-has-provider');
    const soNoMhProviderTextCheckbox = document.getElementById('so-no-mh-provider-text');
    const soSafetyPlanNoProviderCheckbox = document.getElementById('so-safety-plan-no-provider');
    const soOverdoseRiskCheckbox = document.getElementById('so-overdose-risk');
    const soGamblingRiskCheckbox = document.getElementById('so-gambling-risk');
    
    // Entry-CD elements
    const clientGoalsContainer = document.getElementById('client-goals-container');
    const treatmentGoalsContainer = document.getElementById('treatment-goals-container');
    
    // Entry-SO elements
    const soClientGoalsContainer = document.getElementById('so-client-goals-container');
    const soTreatmentGoalsContainer = document.getElementById('so-treatment-goals-container');

    // Narcan elements
    const narcanProvidedCheckbox = document.getElementById('narcan-provided-checkbox');
    const narcanDeclinedCheckbox = document.getElementById('narcan-declined-checkbox');

    // MAT elements
    const matEducationType = document.getElementById('mat-education-type');
    const matNotTakingInfo = document.getElementById('mat-not-taking-info');
    const matAlreadyTakingInfo = document.getElementById('mat-already-taking-info');
    const matResponseDropdown = document.getElementById('mat-response-dropdown');
    const matSubstancesTextbox = document.getElementById('mat-substances-textbox');
    const matExploredOptionsDropdown = document.getElementById('mat-explored-options-dropdown');
    const matNicotineUseDropdown = document.getElementById('mat-nicotine-use-dropdown');
    const matNicotineResourcesSection = document.getElementById('mat-nicotine-resources-section');
    const matNicotineReplacementCheckbox = document.getElementById('mat-nicotine-replacement-checkbox');
    const matNicotineCounselingCheckbox = document.getElementById('mat-nicotine-counseling-checkbox');
    const matNicotineReferralCheckbox = document.getElementById('mat-nicotine-referral-checkbox');
    const matNicotineOtherCheckbox = document.getElementById('mat-nicotine-other-checkbox');
    const matNicotineOtherTextbox = document.getElementById('mat-nicotine-other-textbox');
    
    // Telehealth elements
    const telehealthVisitType = document.getElementById('telehealth-visit-type');
    const telehealthReason = document.getElementById('telehealth-reason');
    const telehealthReasonOther = document.getElementById('telehealth-reason-other');
    const telehealthDisruption = document.getElementById('telehealth-disruption');
    const telehealthDisruptionFollowup = document.getElementById('telehealth-disruption-followup');
    const telehealthDisruptionPlan = document.getElementById('telehealth-disruption-plan');
    const telehealthClientLocation = document.getElementById('telehealth-client-location');
    const telehealthPractitionerLocation = document.getElementById('telehealth-practitioner-location');
    const telehealthPresenceDropdown = document.getElementById('telehealth-presence-dropdown');
    const telehealthOthersPresent = document.getElementById('telehealth-others-present');
    const telehealthSatisfaction = document.getElementById('telehealth-satisfaction');
    const telehealthSatisfactionConcerns = document.getElementById('telehealth-satisfaction-concerns');

    // Closing Note (Admitted) elements
    const closingReason = document.getElementById('closing-reason');
    const closingRecommendations = document.getElementById('closing-recommendations');
    const closingMedsDropdown = document.getElementById('closing-meds-dropdown');
    const closingMedsActionsContainer = document.getElementById('closing-meds-actions-container');
    const closingMedsActions = document.getElementById('closing-meds-actions');
    const closingReferrals = document.getElementById('closing-referrals');
    const closingOfferedToDropdown = document.getElementById('closing-offered-to-dropdown');
    const closingClientResponse = document.getElementById('closing-client-response');

    
    // Closing Note (Non-Admitted) elements
    const nonAdmittedClientType = document.getElementById('non-admitted-client-type');
    const nonAdmittedNoEngageSection = document.getElementById('non-admitted-no-engage-section');
    const nonAdmittedHigherLocSection = document.getElementById('non-admitted-higher-loc-section');
    const nonAdmittedNoCriteriaSection = document.getElementById('non-admitted-no-criteria-section');
    const nonAdmittedEfforts = document.getElementById('non-admitted-efforts');
    const nonAdmittedProvidedTo1 = document.getElementById('non-admitted-provided-to-1');
    const nonAdmittedLocadtr = document.getElementById('non-admitted-locadtr');
    const nonAdmittedEfforts2 = document.getElementById('non-admitted-efforts-2');
    const nonAdmittedProvidedTo2 = document.getElementById('non-admitted-provided-to-2');
    const nonAdmittedProvidedTo3 = document.getElementById('non-admitted-provided-to-3');


    // Get containers
    const evalCdContainer = document.getElementById('eval-cd-container');
    const evalSoContainer = document.getElementById('eval-so-container');
    const entryCdContainer = document.getElementById('entry-cd-container');
    const entrySoContainer = document.getElementById('entry-so-container');
    const narcanContainer = document.getElementById('narcan-container');
    const matContainer = document.getElementById('mat-container');
    const telehealthContainer = document.getElementById('telehealth-container');
    const closingNoteAdmittedContainer = document.getElementById('closing-note-admitted-container');
    const closingNoteNonAdmittedContainer = document.getElementById('closing-note-non-admitted-container');

    const diagnosisOptionsHTML = `
        <option value="" selected disabled>Select a diagnosis...</option>
        <optgroup label="F10: Alcohol Use Disorder"><option value="F10.10: Alcohol use disorder, mild">F10.10: Alcohol use disorder, mild</option><option value="F10.20: Alcohol use disorder, moderate">F10.20: Alcohol use disorder, moderate</option><option value="F10.20: Alcohol use disorder, severe">F10.20: Alcohol use disorder, severe</option></optgroup>
        <optgroup label="F11: Opioid Use Disorder"><option value="F11.10: Opioid use disorder, mild">F11.10: Opioid use disorder, mild</option><option value="F11.20: Opioid use disorder, moderate">F11.20: Opioid use disorder, moderate</option><option value="F11.20: Opioid use disorder, severe">F11.20: Opioid use disorder, severe</option></optgroup>
        <optgroup label="F12: Cannabis Use Disorder"><option value="F12.10: Cannabis use disorder, mild">F12.10: Cannabis use disorder, mild</option><option value="F12.20: Cannabis use disorder, moderate">F12.20: Cannabis use disorder, moderate</option><option value="F12.20: Cannabis use disorder, severe">F12.20: Cannabis use disorder, severe</option></optgroup>
        <optgroup label="F13: Sedative, Hypnotic, or Anxiolytic Use Disorder"><option value="F13.10: Sedative, hypnotic, or anxiolytic use disorder, mild">F13.10: Sedative, hypnotic, or anxiolytic use disorder, mild</option><option value="F13.20: Sedative, hypnotic, or anxiolytic use disorder, moderate">F13.20: Sedative, hypnotic, or anxiolytic use disorder, moderate</option><option value="F13.20: Sedative, hypnotic, or anxiolytic use disorder, severe">F13.20: Sedative, hypnotic, or anxiolytic use disorder, severe</option></optgroup>
        <optgroup label="F14: Cocaine Use Disorder"><option value="F14.10: Stimulant Use Disorder Cocaine, mild">F14.10: Stimulant Use Disorder Cocaine, mild</option><option value="F14.20: Stimulant Use Disorder Cocaine, moderate">F14.20: Stimulant Use Disorder Cocaine, moderate</option><option value="F14.20: Stimulant Use Disorder Cocaine, severe">F14.20: Stimulant Use Disorder Cocaine, severe</option></optgroup>
        <optgroup label="F15: Other Stimulant Use Disorder"><option value="F15.10: Other stimulant use disorder, mild">F15.10: Other stimulant use disorder, mild</option><option value="F15.20: Other stimulant use disorder, moderate">F15.20: Other stimulant use disorder, moderate</option><option value="F15.20: Other stimulant use disorder, severe">F15.20: Other stimulant use disorder, severe</option></optgroup>
        <optgroup label="F16: Hallucinogen Use Disorder"><option value="F16.10: Hallucinogen use disorder, mild">F16.10: Hallucinogen use disorder, mild</option><option value="F16.10: Hallucinogen use disorder, moderate">F16.10: Hallucinogen use disorder, moderate</option><option value="F16.10: Hallucinogen use disorder, severe">F16.10: Hallucinogen use disorder, severe</option></optgroup>
        <optgroup label="F17: Tobacco Use Disorder"><option value="F17.200: Nicotine dependence, unspecified">F17.200: Nicotine dependence, unspecified</option><option value="F17.210: Nicotine dependence, cigarettes, uncomplicated">F17.210: Nicotine dependence, cigarettes, uncomplicated</option><option value="F17.220: Nicotine dependence, chewing tobacco, uncomplicated">F17.220: Nicotine dependence, chewing tobacco, uncomplicated</option><option value="F17.290: Nicotine dependence, other tobacco product, uncomplicated">F17.290: Nicotine dependence, other tobacco product, uncomplicated</option></optgroup>
        <optgroup label="F18: Inhalant Use Disorder"><option value="F18.10: Inhalant use disorder, mild">F18.10: Inhalant use disorder, mild</option><option value="F18.20: Inhalant use disorder, moderate">F18.20: Inhalant use disorder, moderate</option><option value="F18.20: Inhalant use disorder, severe">F18.20: Inhalant use disorder, severe</option></optgroup>
        <optgroup label="F19: Other (or Unknown) Psychoactive Substance Use Disorder"><option value="F19.10: Other psychoactive substance use disorder, mild">F19.10: Other psychoactive substance use disorder, mild</option><option value="F19.20: Other psychoactive substance use disorder, moderate">F19.20: Other psychoactive substance use disorder, moderate</option><option value="F19.20: Other psychoactive substance use disorder, severe">F19.20: Other psychoactive substance use disorder, severe</option></optgroup>
    `;
    
    function createDynamicRow(container, placeholder) {
        const row = document.createElement('div');
        row.className = 'dynamic-row';
        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = placeholder;
        input.addEventListener('input', updateFinalNote);
        const button = document.createElement('button');
        button.type = 'button';

        if (container.children.length === 0) {
            button.className = 'add-btn';
            button.textContent = '+';
            button.onclick = () => createDynamicRow(container, placeholder);
        } else {
            button.className = 'remove-btn';
            button.textContent = '-';
            button.onclick = () => { row.remove(); updateFinalNote(); };
        }
        row.appendChild(input);
        row.appendChild(button);
        container.appendChild(row);
        updateFinalNote();
    }
    
    function addDiagnosisRow() {
        const row = document.createElement('div');
        row.className = 'dynamic-row';
        const select = document.createElement('select');
        select.innerHTML = diagnosisOptionsHTML;
        select.addEventListener('change', updateFinalNote);
        const button = document.createElement('button');
        button.type = 'button';
        if (diagnosisContainer.children.length === 0) {
            button.className = 'add-btn';
            button.textContent = '+';
            button.onclick = addDiagnosisRow;
        } else {
            button.className = 'remove-btn';
            button.textContent = '-';
            button.onclick = () => { row.remove(); updateFinalNote(); };
        }
        row.appendChild(select);
        row.appendChild(button);
        diagnosisContainer.appendChild(row);
        updateFinalNote();
    }

    function resetDiagnosisRows() {
        diagnosisContainer.innerHTML = '';
        addDiagnosisRow();
    }
    
    function resetGoalRows(clientContainer, treatmentContainer) {
        clientContainer.innerHTML = '';
        treatmentContainer.innerHTML = '';
        createDynamicRow(clientContainer, 'Enter client goal...');
        createDynamicRow(treatmentContainer, 'Enter treatment plan goal...');
    }

    function autoResize(element) {
        element.style.height = 'auto';
        element.style.height = (element.scrollHeight) + 'px';
    }

    function updateFinalNote() {
        const selectedNoteType = noteTypeSelect.value;
        let finalNote = '';

        // Hide all containers first
        document.querySelectorAll('.note-container').forEach(c => c.classList.add('hidden'));

        if (selectedNoteType === 'eval-cd') {
            evalCdContainer.classList.remove('hidden');
            const mandateSentence = "The clinician clarified the implications of external mandates, noting that mandated status does not override the client’s right to voluntary engagement in treatment or toxicology screenings. Corresponding handouts were provided.";
            const diagnosisElements = diagnosisContainer.querySelectorAll('select');
            const selectedOptions = Array.from(diagnosisElements).map(select => select.value).filter(val => val);
            const diagnosis = selectedOptions.length > 0 ? selectedOptions.join(', ') : '[SPECIFY DIAGNOSIS]';
            const details = detailsTextarea.value || '[DETAILS OF CRITERIA MET]';
            
            let baseNote = `The client presented for services and meets diagnostic criteria for a substance use disorder, specifically ${diagnosis}, as evidenced by: \n\n${details}\n\nThe clinician reviewed: Program expectations, rules, and attendance policies; Delphi Rise’s policy as a tobacco, nicotine, alcohol, and drug-free environment; and Client rights and responsibilities, including HIPAA and 42 CFR Part 2 confidentiality protections.\n\nThe clinician confirmed client understanding and emphasized the collaborative nature of recovery, highlighting the agency’s role in supporting the client’s treatment goals. The client demonstrated an understanding that participation in services is voluntary and may be discontinued at any time.${mandateCheckbox.checked ? ' ' + mandateSentence : ''}\n\nThe clinician reviewed the client’s screening results and supported the client in understanding their scores. A comprehensive review of the client’s presenting concerns, referral reason, psychosocial needs, and current and historical functioning was conducted to assess eligibility for Outpatient services. The client's initial treatment goal is to complete the evaluation process; additional goals will be developed collaboratively in future sessions.`;

            let scenariosText = [];
            if (cdHasMhProviderTextCheckbox.checked) {
                let text = cdHasMhProviderTextCheckbox.nextElementSibling.textContent;
                if (cdSafetyPlanHasProviderCheckbox.checked) {
                    text += ' ' + cdSafetyPlanHasProviderCheckbox.nextElementSibling.textContent;
                }
                scenariosText.push(text);
            }
            if (cdNoMhProviderTextCheckbox.checked) {
                let text = cdNoMhProviderTextCheckbox.nextElementSibling.textContent;
                if (cdSafetyPlanNoProviderCheckbox.checked) {
                    text += ' ' + cdSafetyPlanNoProviderCheckbox.nextElementSibling.textContent;
                }
                scenariosText.push(text);
            }
            if (cdOverdoseRiskCheckbox.checked) {
                scenariosText.push(cdOverdoseRiskCheckbox.nextElementSibling.textContent);
            }
            if (cdGamblingRiskCheckbox.checked) {
                scenariosText.push(cdGamblingRiskCheckbox.nextElementSibling.textContent);
            }

            if (scenariosText.length > 0) {
                finalNote = baseNote + "\n\n" + scenariosText.join("\n\n");
            } else {
                finalNote = baseNote;
            }
        
        } else if (selectedNoteType === 'eval-so') {
            evalSoContainer.classList.remove('hidden');
            const diagnosis = soDiagnosisSelect.value;
            const details = soDetailsTextarea.value || '[DETAILS OF CRITERIA MET]';
            let baseNote = `The client presented for services due to experiencing stress related to supporting someone in their life who struggles with substance use. The client meets diagnostic criteria, specifically ${diagnosis}, as evidenced by: \n\n${details}\n\nThe clinician reviewed: Program expectations, rules, and attendance policies; Delphi Rise’s policy as a tobacco, nicotine, alcohol, and drug-free environment; and Client rights and responsibilities, including HIPAA and 42 CFR Part 2 confidentiality protections.\n\nThe clinician confirmed client understanding and emphasized the collaborative nature of treatment, highlighting the agency’s role in supporting the client’s treatment goals. The client demonstrated an understanding that participation in services is voluntary and may be discontinued at any time.\n\nThe clinician reviewed the client’s screening results and supported the client in understanding their scores. A comprehensive review of the client’s presenting concerns, referral reason, psychosocial needs, and current and historical functioning was conducted to assess eligibility for Outpatient services. The client's initial treatment goal is to complete the evaluation process; additional goals will be developed collaboratively in future sessions.`;
            
            let scenariosText = [];
            if (soHasMhProviderTextCheckbox.checked) {
                let text = soHasMhProviderTextCheckbox.nextElementSibling.textContent;
                if (soSafetyPlanHasProviderCheckbox.checked) {
                    text += ' ' + soSafetyPlanHasProviderCheckbox.nextElementSibling.textContent;
                }
                scenariosText.push(text);
            }
            if (soNoMhProviderTextCheckbox.checked) {
                let text = soNoMhProviderTextCheckbox.nextElementSibling.textContent;
                if (soSafetyPlanNoProviderCheckbox.checked) {
                    text += ' ' + soSafetyPlanNoProviderCheckbox.nextElementSibling.textContent;
                }
                scenariosText.push(text);
            }
            if (soOverdoseRiskCheckbox.checked) {
                scenariosText.push(soOverdoseRiskCheckbox.nextElementSibling.textContent);
            }
            if (soGamblingRiskCheckbox.checked) {
                scenariosText.push(soGamblingRiskCheckbox.nextElementSibling.textContent);
            }

            if (scenariosText.length > 0) {
                finalNote = baseNote + "\n\n" + scenariosText.join("\n\n");
            } else {
                finalNote = baseNote;
            }

        } else if (selectedNoteType === 'entry-cd') {
            entryCdContainer.classList.remove('hidden');
            const clientGoals = Array.from(clientGoalsContainer.querySelectorAll('input')).map(input => input.value).filter(val => val);
            const treatmentGoals = Array.from(treatmentGoalsContainer.querySelectorAll('input')).map(input => input.value).filter(val => val);
            
            let clientGoalsText = clientGoals.length > 0 ? '\n' + clientGoals.map(goal => `"${goal}"`).join('\n') : ' [CLIENT-STATED GOALS / CLIENT VOICE/QUOTES]';
            let treatmentGoalsText = treatmentGoals.length > 0 ? '\n' + treatmentGoals.join('\n') : ' [TREATMENT PLAN GOALS]';

            finalNote = `The client has identified personal goals to support their recovery, including:${clientGoalsText}\n\nBased on the client’s psychosocial needs, current presentation, and clinical history, the client is expected to benefit from the following treatment plan goals:${treatmentGoalsText}\n\nThe clinician reviewed all services available through the Outpatient clinic, with a focus on peer support, medication management, and therapeutic group offerings. Corresponding handouts were provided to support the client’s engagement and alignment with their identified recovery goals.`;

        } else if (selectedNoteType === 'entry-so') {
            entrySoContainer.classList.remove('hidden');
            const clientGoals = Array.from(soClientGoalsContainer.querySelectorAll('input')).map(input => input.value).filter(val => val);
            const treatmentGoals = Array.from(soTreatmentGoalsContainer.querySelectorAll('input')).map(input => input.value).filter(val => val);
            
            let clientGoalsText = clientGoals.length > 0 ? '\n' + clientGoals.map(goal => `"${goal}"`).join('\n') : ' [CLIENT-STATED GOALS / CLIENT VOICE/QUOTES]';
            let treatmentGoalsText = treatmentGoals.length > 0 ? '\n' + treatmentGoals.join('\n') : ' [TREATMENT PLAN GOALS]';

            finalNote = `The client has identified personal goals to support their recovery, including:${clientGoalsText}\n\nBased on the client’s psychosocial needs, current presentation, and clinical history, the client is expected to benefit from the following treatment plan goals:${treatmentGoalsText}\n\nThe clinician reviewed all services available through the Outpatient clinic, with a focus on peer support, medication management, and therapeutic group offerings. Corresponding handouts were provided to support the client’s engagement and alignment with their identified recovery goals.`;
        
        } else if (selectedNoteType === 'narcan-kit') {
            narcanContainer.classList.remove('hidden');
            if (narcanProvidedCheckbox.checked) {
                finalNote = "Writer provided Ct with an overview of Narcan, showed a brief video demonstrating how to use Narcan, and provided Ct with a Narcan kit.";
            } else if (narcanDeclinedCheckbox.checked) {
                finalNote = "Ct declined Narcan training when offered and declined to accept a Narcan kit.";
            } else {
                finalNote = "";
            }
        
        } else if (selectedNoteType === 'mat-education') {
            matContainer.classList.remove('hidden');
            let noteParts = [];
            if (matEducationType.value === 'not-taking') {
                noteParts.push("Medication Assisted Treatment (MAT) has been introduced, and education has been offered based on client's history and current presentation. Writer provided client with an overview of MAT’s benefits & risks, and offered to connect client to medication management in our clinic, including smoking and nicotine cessation services");
            } else if (matEducationType.value === 'already-taking') {
                 noteParts.push("Client is currently taking medication to manage their Substance Use Disorder");
            }

            if (matResponseDropdown.value) {
                noteParts.push(`Based on the discussion, ${matResponseDropdown.value}`);
            }
            
            if (matExploredOptionsDropdown.value) {
                const exploredText = matExploredOptionsDropdown.value === 'did' ? 'did' : 'did not';
                const substances = matSubstancesTextbox.value || '[list relevant substances, e.g., opioids, alcohol, etc.]';
                noteParts.push(`The clinician ${exploredText} explore specific MAT options tailored to the substances reported by the client, including ${substances}`);
            }

            if (matNicotineUseDropdown.value) {
                const nicotineUse = matNicotineUseDropdown.value;
                let nicotineSentence = `The client ${nicotineUse} report current nicotine use`;
                if (nicotineUse === 'does') {
                    let resources = [];
                    if (matNicotineReplacementCheckbox.checked) resources.push('nicotine replacement options');
                    if (matNicotineCounselingCheckbox.checked) resources.push('tobacco cessation counseling');
                    if (matNicotineReferralCheckbox.checked) resources.push('referral to a tobacco cessation program');
                    if (matNicotineOtherCheckbox.checked && matNicotineOtherTextbox.value) {
                        resources.push(matNicotineOtherTextbox.value);
                    }
                    if (resources.length > 0) {
                        nicotineSentence += `, and the following nicotine cessation resources were provided: ${resources.join(', ')}`;
                    }
                }
                noteParts.push(nicotineSentence);
            }
            if (noteParts.length > 0) {
                noteParts.push("The Clinician will connect client to the program nurse for further support and information");
                noteParts.push("Medication Assisted Treatment Toolkit for Counselors");
            }
            finalNote = noteParts.join('. ').replace(/\.\./g, '.'); // Join and clean up double periods
            if(finalNote) finalNote += '.';

        } else if (selectedNoteType === 'telehealth') {
            telehealthContainer.classList.remove('hidden');
            
            telehealthReasonOther.style.display = (telehealthReason.value === 'other') ? 'inline-block' : 'none';
            telehealthDisruptionFollowup.style.display = (telehealthDisruption.value === 'was a service disruption') ? 'inline-block' : 'none';
            telehealthSatisfactionConcerns.style.display = (telehealthSatisfaction.value === 'expressed the following concerns:') ? 'inline-block' : 'none';
            telehealthOthersPresent.style.display = (telehealthPresenceDropdown.value === 'others') ? 'inline-block' : 'none';

            let noteParts = [];
            
            if (telehealthVisitType.value) {
                noteParts.push(`This session was conducted via ${telehealthVisitType.value}, and client is clinically appropriate to receive services via telepractice`);
            }
            
            let reason = telehealthReason.value;
            if (reason === 'other') {
                reason = telehealthReasonOther.value || '[specify]';
            }
            if (reason) {
                noteParts.push(`the use of telepractice was due to ${reason}`);
            }
            
            let disruption = telehealthDisruption.value;
            if (disruption) {
                let disruptionText = `there ${disruption}`;
                if (disruption === 'was a service disruption') {
                    const plan = telehealthDisruptionPlan.value || '[plan for follow-up]';
                    disruptionText += `. Writer will follow up by ${plan}`;
                }
                noteParts.push(disruptionText);
            }

            const clientLocation = telehealthClientLocation.value || '[client location]';
            const practitionerLocation = telehealthPractitionerLocation.value || '[practitioner location]';
            noteParts.push(`the client was located at ${clientLocation}, and the practitioner was located at ${practitionerLocation} at the time of the session`);
            
            let presence = telehealthPresenceDropdown.value;
            if (presence === 'only') {
                noteParts.push('Provider and client were the only individuals present in the session');
            } else if (presence === 'others') {
                const others = telehealthOthersPresent.value || '[specify]';
                noteParts.push(`in addition to the provider and client, the following individual(s) were present with the client: ${others}`);
            }

            let satisfaction = telehealthSatisfaction.value;
            if (satisfaction) {
                let satisfactionText = satisfaction;
                if (satisfaction.startsWith('expressed the following concerns')) {
                    const concerns = telehealthSatisfactionConcerns.value || '[specify]';
                    satisfactionText += ` ${concerns}`;
                }
                noteParts.push(`The client was asked about their satisfaction with receiving services via telepractice and ${satisfactionText}`);
            }

            finalNote = noteParts.map(s => s.charAt(0).toUpperCase() + s.slice(1)).join('. ').replace(/\.\s\./g, '.');
            if (finalNote && !finalNote.endsWith('.')) finalNote += '.';

        } else if (selectedNoteType === 'closing-note-admitted') {
            closingNoteAdmittedContainer.classList.remove('hidden');

            let noteParts = [];
            const reason = closingReason.value || '[reason for discharge]';
            noteParts.push(`Client was discharged due to ${reason}`);

            const recommendations = closingRecommendations.value || '[recommended treatment plan or next steps]';
            noteParts.push(`Treatment recommendations include ${recommendations}`);

            const meds = closingMedsDropdown.value;
            if (meds) {
                let medsSentence = `The client ${meds} currently prescribed medications most recently prescribed at Delphi`;
                if (meds === 'is') {
                    const actions = closingMedsActions.value || '[describe actions taken, e.g., medication reconciliation, prescription coordination, referral to prescriber, etc.]';
                    medsSentence += `. The following actions were taken to support the client’s medication management: ${actions}`;
                }
                noteParts.push(medsSentence);
            }

            const referrals = closingReferrals.value || '[list referrals, e.g., outpatient counseling, primary care, housing support, etc.]';
            noteParts.push(`Referrals initiated to support the client post-discharge include: ${referrals}`);

            const offeredTo = closingOfferedToDropdown.value;
            noteParts.push(`The ${offeredTo} was offered a copy of their discharge plan, a recovery resource handout outlining community resources for urgent support, harm reduction resources, referrals to MAT providers and recovery peer services, and an overdose prevention/Narcan kit`);
            
            const clientResponse = closingClientResponse.value;
            if (clientResponse) {
                noteParts.push(`Client's Response to Resources Offered at Discharge: ${clientResponse}`);
            }

            finalNote = noteParts.map(s => s.charAt(0).toUpperCase() + s.slice(1)).join('. ').replace(/\.\s\./g, '.');
             if (finalNote && !finalNote.endsWith('.')) finalNote += '.';

        } else if (selectedNoteType === 'closing-note-non-admitted') {
            closingNoteNonAdmittedContainer.classList.remove('hidden');
            const clientType = nonAdmittedClientType.value;
            if (clientType === 'no-engage') {
                const efforts = nonAdmittedEfforts.value || '[list efforts]';
                const providedTo = nonAdmittedProvidedTo1.value ? ` and also provided to: ${nonAdmittedProvidedTo1.value}` : '';
                finalNote = `Client will not be admitted for treatment at this time due to not engaging in treatment beyond their evaluation(s). Engagement efforts included ${efforts}. The decision not to admit was provided via mail to client${providedTo}. Included in this letter is a recovery resource handout outlining community resources for urgent support, harm reduction resources, MAT providers, and recovery peer services.`;
            } else if (clientType === 'higher-loc') {
                const locadtr = nonAdmittedLocadtr.value || '[LOCADTR outcome]';
                const efforts = nonAdmittedEfforts2.value || '[list efforts made, e.g., coordination with other providers, referral outreach, discussion with client/family, etc.]';
                const providedTo = nonAdmittedProvidedTo2.value ? ` and also provided to: ${nonAdmittedProvidedTo2.value}` : '';
                finalNote = `The client will not be admitted for treatment at this time, as they meet criteria for a higher level of care ${locadtr}. Following a thorough review and discussion by the multidisciplinary team, it was determined that the client’s needs would be more safely and appropriately addressed in a setting equipped to provide a higher intensity of services. Efforts to explore treatment options and identify appropriate referrals were made, including: ${efforts}. The decision not to admit was communicated to the client via mail${providedTo}. Included in the letter was a recovery resource handout outlining local options for urgent support, harm reduction services, MAT providers, and peer recovery resources.`;
            } else if (clientType === 'no-criteria') {
                const providedTo = nonAdmittedProvidedTo3.value ? ` and ${nonAdmittedProvidedTo3.value}` : '';
                finalNote = `Client will not be admitted for treatment at this time due to not meeting admission criteria. Urine screen was negative, no concerns were reported by collateral contacts, and LOCADTR does not indicate a recommended level of care. An outcome letter was provided to the client${providedTo}.`;
            }
        }


        finalNoteCopy.value = finalNote.trim();
        autoResize(finalNoteCopy);
    }

    function toggleSafetyPlan(mainCheckbox, safetyPlanCheckbox) {
        safetyPlanCheckbox.disabled = !mainCheckbox.checked;
        if (!mainCheckbox.checked) {
            safetyPlanCheckbox.checked = false;
        }
    }

    // EVENT LISTENERS
    noteTypeSelect.addEventListener('change', () => {
        if (noteTypeSelect.value === 'eval-cd') {
            resetDiagnosisRows();
        } else if (noteTypeSelect.value === 'entry-cd') {
            resetGoalRows(clientGoalsContainer, treatmentGoalsContainer);
        } else if (noteTypeSelect.value === 'entry-so') {
            resetGoalRows(soClientGoalsContainer, soTreatmentGoalsContainer);
        } else if (noteTypeSelect.value === 'telehealth') {
            telehealthPractitionerLocation.value = "72 Hinchey Road, Rochester, NY";
        }
        updateFinalNote();
    });
    
    // Eval-CD Listeners
    detailsTextarea.addEventListener('input', () => { autoResize(detailsTextarea); updateFinalNote(); });
    mandateCheckbox.addEventListener('change', updateFinalNote);
    cdHasMhProviderTextCheckbox.addEventListener('change', () => { toggleSafetyPlan(cdHasMhProviderTextCheckbox, cdSafetyPlanHasProviderCheckbox); updateFinalNote(); });
    cdNoMhProviderTextCheckbox.addEventListener('change', () => { toggleSafetyPlan(cdNoMhProviderTextCheckbox, cdSafetyPlanNoProviderCheckbox); updateFinalNote(); });
    cdSafetyPlanHasProviderCheckbox.addEventListener('change', updateFinalNote);
    cdSafetyPlanNoProviderCheckbox.addEventListener('change', updateFinalNote);
    cdOverdoseRiskCheckbox.addEventListener('change', updateFinalNote);
    cdGamblingRiskCheckbox.addEventListener('change', updateFinalNote);

    // Eval-SO Listeners
    soDiagnosisSelect.addEventListener('change', updateFinalNote);
    soDetailsTextarea.addEventListener('input', () => { autoResize(soDetailsTextarea); updateFinalNote(); });
    soHasMhProviderTextCheckbox.addEventListener('change', () => { toggleSafetyPlan(soHasMhProviderTextCheckbox, soSafetyPlanHasProviderCheckbox); updateFinalNote(); });
    soNoMhProviderTextCheckbox.addEventListener('change', () => { toggleSafetyPlan(soNoMhProviderTextCheckbox, soSafetyPlanNoProviderCheckbox); updateFinalNote(); });
    soSafetyPlanHasProviderCheckbox.addEventListener('change', updateFinalNote);
    soSafetyPlanNoProviderCheckbox.addEventListener('change', updateFinalNote);
    soOverdoseRiskCheckbox.addEventListener('change', updateFinalNote);
    soGamblingRiskCheckbox.addEventListener('change', updateFinalNote);

    // Narcan Listeners
    narcanProvidedCheckbox.addEventListener('change', () => {
        if (narcanProvidedCheckbox.checked) narcanDeclinedCheckbox.checked = false;
        updateFinalNote();
    });
    narcanDeclinedCheckbox.addEventListener('change', () => {
        if (narcanDeclinedCheckbox.checked) narcanProvidedCheckbox.checked = false;
        updateFinalNote();
    });

    // MAT Listeners
    matEducationType.addEventListener('change', () => {
        matNotTakingInfo.classList.toggle('hidden', matEducationType.value !== 'not-taking');
        matAlreadyTakingInfo.classList.toggle('hidden', matEducationType.value !== 'already-taking');
        updateFinalNote();
    });
    matNicotineUseDropdown.addEventListener('change', () => {
        matNicotineResourcesSection.classList.toggle('hidden', matNicotineUseDropdown.value !== 'does');
        updateFinalNote();
    });
    matNicotineOtherCheckbox.addEventListener('change', () => {
        matNicotineOtherTextbox.classList.toggle('hidden', !matNicotineOtherCheckbox.checked);
        updateFinalNote();
    });
    [matResponseDropdown, matSubstancesTextbox, matExploredOptionsDropdown, matNicotineReplacementCheckbox, matNicotineCounselingCheckbox, matNicotineReferralCheckbox, matNicotineOtherTextbox].forEach(el => {
        el.addEventListener('input', updateFinalNote);
        el.addEventListener('change', updateFinalNote);
    });
    
    // Telehealth Listeners
    [telehealthVisitType, telehealthReason, telehealthDisruption, telehealthSatisfaction, telehealthPresenceDropdown].forEach(el => {
        el.addEventListener('change', updateFinalNote);
    });
    [telehealthReasonOther, telehealthDisruptionPlan, telehealthClientLocation, telehealthPractitionerLocation, telehealthOthersPresent, telehealthSatisfactionConcerns].forEach(el => {
        el.addEventListener('input', updateFinalNote);
    });
    
    // Closing Note (Admitted) Listeners
    closingMedsDropdown.addEventListener('change', () => {
        closingMedsActionsContainer.classList.toggle('hidden', closingMedsDropdown.value !== 'is');
        updateFinalNote();
    });
    [closingReason, closingRecommendations, closingMedsActions, closingReferrals, closingOfferedToDropdown, closingClientResponse].forEach(el => {
        el.addEventListener('input', updateFinalNote);
        el.addEventListener('change', updateFinalNote);
    });
    
    // Closing Note (Non-Admitted) Listeners
    nonAdmittedClientType.addEventListener('change', () => {
        nonAdmittedNoEngageSection.classList.toggle('hidden', nonAdmittedClientType.value !== 'no-engage');
        nonAdmittedHigherLocSection.classList.toggle('hidden', nonAdmittedClientType.value !== 'higher-loc');
        nonAdmittedNoCriteriaSection.classList.toggle('hidden', nonAdmittedClientType.value !== 'no-criteria');
        updateFinalNote();
    });
    [nonAdmittedEfforts, nonAdmittedProvidedTo1, nonAdmittedLocadtr, nonAdmittedEfforts2, nonAdmittedProvidedTo2, nonAdmittedProvidedTo3].forEach(el => {
        el.addEventListener('input', updateFinalNote);
    });


    // Copy Button functionality
    copyButton.addEventListener('click', () => {
        finalNoteCopy.select();
        navigator.clipboard.writeText(finalNoteCopy.value).then(() => {
            const originalText = copyButton.textContent;
            copyButton.textContent = 'Copied!';
            copyButton.style.backgroundColor = '#1e7e34';
            setTimeout(() => { copyButton.textContent = originalText; copyButton.style.backgroundColor = '#28a745'; }, 1500);
        }).catch(err => {
            console.error('Failed to copy text: ', err);
            try { document.execCommand('copy'); } catch (e) { console.error('Fallback copy failed', e); }
        });
    });

    // Initial call to populate the form on page load
    document.addEventListener('DOMContentLoaded', () => {
        resetDiagnosisRows();
        resetGoalRows(clientGoalsContainer, treatmentGoalsContainer);
        resetGoalRows(soClientGoalsContainer, soTreatmentGoalsContainer);
        toggleSafetyPlan(cdHasMhProviderTextCheckbox, cdSafetyPlanHasProviderCheckbox);
        toggleSafetyPlan(cdNoMhProviderTextCheckbox, cdSafetyPlanNoProviderCheckbox);
        toggleSafetyPlan(soHasMhProviderTextCheckbox, soSafetyPlanHasProviderCheckbox);
        toggleSafetyPlan(soNoMhProviderTextCheckbox, soSafetyPlanNoProviderCheckbox);
        matNicotineResourcesSection.classList.toggle('hidden', matNicotineUseDropdown.value !== 'does');
        matNicotineOtherTextbox.classList.toggle('hidden', !matNicotineOtherCheckbox.checked);
        updateFinalNote();
    });

</script>

</body>
</html>
